#!/bin/sh

################################################################
#
# ppath
#   - program path
#
# written by raptowl on 2019/11/16
#
################################################################

################################################################
# preprocessing
################################################################

# initialize shell environment
set -u
umask 0022
LC_ALL=C
UNIX_STD=2003
export LC_ALL UNIX_STD

# load and define functions
. "$DOTFILES_LOC/lib/log/logging_error.sh"

usage() {
  cat <<_EOT_ >&2
Usage: ${0##*/} [-h | --help] <command>

${0##*/} is a utility to output whether <command> exists in any directories
described on PATH environment variables.

option:
  -h | --help: print out the usage to stderr
_EOT_
  exit 1
}

################################################################
# argument parsing
################################################################

# print the usage and exit
case "$# ${1:-}" in
  '1 -h'|'1 --help')
    usage
    ;;
esac

# parse options
while :; do
  case "${1:-}" in
    --)
      shift
      break
      ;;
    -*)
      logging_error "invalid option: $1"
      exit 1
      ;;
    *)
      break
      ;;
  esac
done

if [ $# -ne 1 ]; then
  logging_error 'invalid arguments'
  exit 1
fi

################################################################
# main routine
################################################################

printf '%s\n' "$PATH" \
  | tr ':' '\n' \
  | sed -e 's%$%/'"$1"'%' \
  | xargs file \
  | sed -e 's%:  *%:%' \
  | awk -F ':' '! match($2, "cannot open.*") { print $1; }' \
  | grep -e '^' \
  || exit 1

exit 0
